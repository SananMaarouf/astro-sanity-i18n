---
import { loadQuery } from "../sanity/lib/load-query";
import type { Landing } from "../../types/landing";
import { urlForImage } from "../sanity/lib/url-for-image";

interface Props {
	lang?: string;
}

const { lang = 'en' } = Astro.props;

const { data: landing } = await loadQuery<Landing>({
	query: `*[_type == "Landing"] | order(_createdAt desc)[0]{
	 "title": title[_key == $lang][0].value,
	 image{
		asset,
		alt
	 },
	 youtubeUrl,
	 video{
		asset->{
			url
		}
	 },
	 "ctaText": ctaText[_key == $lang][0].value,
	 "ctaBtnText": ctaBtnText[_key == $lang][0].value
  }`,
	params: { lang },
});

const bgUrl = landing.image?.asset ? urlForImage(landing.image.asset).url() : "";
const posterUrl = bgUrl;
---

<div 
	class="relative mt-8 max-w-5xl mx-auto rounded-lg overflow-hidden"
	style={bgUrl ? `background-image: url('${bgUrl}'); background-size: cover; background-position: center;` : ""}
>
	<div class="absolute inset-0 bg-black/40"></div>
	<section class="relative flex flex-row items-center justify-center z-10" style="min-height: 350px;">
		<div class="w-1/2 flex flex-col items-start justify-center p-8">
			<h1 class="text-2xl md:text-3xl lg:text-4xl font-extrabold mb-4 text-white drop-shadow">{landing.title}</h1>
			{landing.ctaText && <p class="text-lg text-white drop-shadow">{landing.ctaText}</p>}
		</div>
		<div class="w-1/2 flex items-center justify-center p-8">
			{landing.video?.asset && (
				<video controls width="100%" class="mx-auto mb-6 rounded-lg shadow-lg" poster={posterUrl} autoplay muted loop>
					<source src={landing.video.asset.url} type="video/mp4" />
					Your browser does not support the video tag.
				</video>
			)}
		</div>
	</section>
	<div class="relative z-10 text-center px-8 pb-8">
		{landing.youtubeUrl && (
			<div class="mb-6 flex justify-center">
				<iframe
					width="560"
					height="315"
					src={`https://www.youtube.com/embed/${landing.youtubeUrl}`}
					title="YouTube video"
					allowfullscreen
					class="mx-auto rounded-lg shadow-lg"
				/>
			</div>
		)}
		{landing.ctaBtnText && (
			<button class="
				inline-block mb-8 px-6 py-3 
				rounded-lg text-lg bg-primary text-primary-foreground font-semibold
				shadow-lg
			">
				{landing.ctaBtnText}
			</button>
		)}
	</div>
</div>
